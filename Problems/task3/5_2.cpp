//////////////////////////////////////////////////////////////////

#include <cassert>
#include <string>

//////////////////////////////////////////////////////////////////
// Entity — виртуальный базовый интерфейс
//////////////////////////////////////////////////////////////////

class Entity
{
public:
    virtual ~Entity() = default;
    virtual std::string name() const = 0;
};

//////////////////////////////////////////////////////////////////
// Concrete entity
//////////////////////////////////////////////////////////////////

class Person : public virtual Entity
{
public:
    std::string name() const override
    {
        return "Person";
    }
};

//////////////////////////////////////////////////////////////////
// Decorator<T> — шаблонный декоратор
//////////////////////////////////////////////////////////////////

template <typename T>
class Decorator : public virtual Entity, public T
{
    // нет конструктора
    // нет ссылки / указателя на Entity
};

//////////////////////////////////////////////////////////////////
// Concrete decorators
//////////////////////////////////////////////////////////////////

template <typename T>
class Student : public Decorator<T>
{
public:
    std::string name() const override
    {
        return T::name() + " Student";
    }
};

template <typename T>
class Employee : public Decorator<T>
{
public:
    std::string name() const override
    {
        return T::name() + " Employee";
    }
};

//////////////////////////////////////////////////////////////////
// Tests
//////////////////////////////////////////////////////////////////

int main()
{
    Person p;
    assert(p.name() == "Person");

    Student<Person> s;
    assert(s.name() == "Person Student");

    Employee<Student<Person>> e;
    assert(e.name() == "Person Student Employee");
}

//////////////////////////////////////////////////////////////////
